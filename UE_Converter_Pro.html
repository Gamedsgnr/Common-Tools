<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>UE Data Converter Pro</title>
    <style>
        :root { --bg: #1e1e1e; --panel: #252526; --accent: #007acc; --text: #d4d4d4; --green: #4ec9b0; --orange: #ce9178; }
        body { font-family: 'Segoe UI', Consolas, sans-serif; background-color: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .container { background-color: var(--panel); width: 800px; padding: 25px; border-radius: 8px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        h2 { margin-top: 0; color: var(--green); border-bottom: 1px solid #333; padding-bottom: 10px; }
        h4 { margin: 15px 0 5px 0; color: #9cdcfe; }
        
        .row { display: flex; gap: 20px; margin-bottom: 15px; }
        .col { flex: 1; display: flex; flex-direction: column; }
        
        textarea { background: #3c3c3c; color: white; border: 1px solid #333; padding: 10px; border-radius: 4px; height: 120px; font-family: monospace; resize: vertical; }
        input[type="text"] { background: #3c3c3c; color: var(--orange); border: 1px solid #333; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 1.1em; }
        
        .controls { background: #2d2d2d; padding: 15px; border-radius: 6px; border: 1px solid #3e3e3e; }
        
        label { font-size: 0.85em; color: #aaa; margin-bottom: 4px; display: block; }
        
        button { background-color: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; margin-top: 10px; }
        button:hover { background-color: #0062a3; }
        button.secondary { background-color: #3e3e3e; font-size: 0.8em; padding: 5px 10px; margin-top: 0; margin-right: 5px; }
        
        .presets { margin-bottom: 10px; }
        .help-text { font-size: 0.8em; color: #666; margin-top: 5px; font-style: italic; }

        .token { color: var(--green); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ† UE Data Converter Pro</h2>

    <div class="row">
        <div class="col">
            <h4>1. –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Array –∏–ª–∏ Map)</h4>
            <textarea id="inputStr" placeholder="–ü—Ä–∏–º–µ—Ä—ã:&#10;Organics, Helium3&#10;((A, 0.5), (B, 1.2))&#10;Key=Value, Key2=Value2">Organics,Helium3,Nanotube,AluClear</textarea>
        </div>
    </div>

    <div class="controls">
        <div class="row">
            <div class="col">
                <label>–®–∞–±–ª–æ–Ω —ç–ª–µ–º–µ–Ω—Ç–∞ (Pattern):</label>
                <input type="text" id="pattern" value="({k}, {v})">
                <div class="help-text">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <span class="token">{k}</span> –¥–ª—è –∫–ª—é—á–∞ –∏ <span class="token">{v}</span> –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è.</div>
            </div>
            <div class="col">
                <label>–î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ({v}):</label>
                <input type="text" id="defaultVal" value="0.000000">
                <div class="help-text">–ü–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è, –µ—Å–ª–∏ –≤–æ –≤—Ö–æ–¥–µ –Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏).</div>
            </div>
        </div>

        <div class="presets">
            <label>–ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã:</label>
            <button class="secondary" onclick="setPattern('({k}, {v})')">UE Struct ((K,V))</button>
            <button class="secondary" onclick="setPattern('{k}={v}')">UE Key=Val</button>
            <button class="secondary" onclick="setPattern('&#34;{k}&#34;')">"String"</button>
            <button class="secondary" onclick="setPattern('{k}')">–¢–æ–ª—å–∫–æ –ö–ª—é—á–∏</button>
            <button class="secondary" onclick="setPattern('{v}')">–¢–æ–ª—å–∫–æ –ó–Ω–∞—á–µ–Ω–∏—è</button>
            <button class="secondary" onclick="setPattern('TEXT(&#34;{k}&#34;)')">C++ TEXT</button>
        </div>

        <div class="row">
            <div class="col">
                <label>–û–±–µ—Ä–Ω—É—Ç—å –≤–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å–∫–æ–±–∫–∏?</label>
                <div style="display:flex; align-items:center; gap:10px;">
                    <input type="checkbox" id="wrapResult" checked> <span style="font-size:0.9em">–î–æ–±–∞–≤–∏—Ç—å (...) –≤–æ–∫—Ä—É–≥ –≤—Å–µ–≥–æ —Å–ø–∏—Å–∫–∞</span>
                </div>
            </div>
        </div>
        
        <button onclick="processData()" style="width: 100%">–ö–û–ù–í–ï–†–¢–ò–†–û–í–ê–¢–¨</button>
    </div>

    <div class="row">
        <div class="col">
            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç</h4>
            <textarea id="outputArea" readonly></textarea>
            <button class="secondary" onclick="copyResult()" style="width: auto; align-self: flex-start; margin-top:5px;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>
</div>

<script>
    function setPattern(val) {
        document.getElementById('pattern').value = val;
    }

    function processData() {
        const input = document.getElementById('inputStr').value;
        const pattern = document.getElementById('pattern').value;
        const defaultVal = document.getElementById('defaultVal').value;
        const wrapResult = document.getElementById('wrapResult').checked;

        // 1. –û—á–∏—Å—Ç–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–∫–æ–±–æ–∫ –º–∞—Å—Å–∏–≤–∞ UE "(...)"
        let raw = input.trim();
        if (raw.startsWith('(') && raw.endsWith(')')) {
            // –ü—ã—Ç–∞–µ–º—Å—è —Å–Ω—è—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–∫–æ–±–∫–∏, –Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Å–ª–æ–º–∞—Ç—å ((A,B)) -> (A,B)
            // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±–æ–ª–æ—á–∫–∞ —Å–ø–∏—Å–∫–∞
            // –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å—Ç–æ –ø–∞—Ä—Å–∏–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏
            raw = raw.substring(1, raw.length - 1);
        }

        // 2. –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã (–°–ø–ª–∏—Ç –ø–æ –∑–∞–ø—è—Ç–æ–π, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∑–∞–ø—è—Ç—ã–µ –≤–Ω—É—Ç—Ä–∏ —Å–∫–æ–±–æ–∫)
        // –†–µ–≥—É–ª—è—Ä–∫–∞ –∏—â–µ—Ç –∑–∞–ø—è—Ç—É—é, –∑–∞ –∫–æ—Ç–æ—Ä–æ–π –ù–ï —Å–ª–µ–¥—É–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –±–µ–∑ –æ—Ç–∫—Ä—ã–≤–∞—é—â–µ–π (–ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π –±–∞–ª–∞–Ω—Å)
        // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–∑–æ–±—å–µ–º —Å–Ω–∞—á–∞–ª–∞ –ø–æ –∑–∞–ø—è—Ç—ã–º, –∞ –ø–æ—Ç–æ–º —Å–∫–ª–µ–∏–º –µ—Å–ª–∏ —Ä–∞–∑–±–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        let parts = raw.split(/,(?![^(]*\))/g); 
        
        let parsedData = [];

        parts.forEach(part => {
            part = part.trim();
            if (!part) return;

            let key = part;
            let val = defaultVal;

            // –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–∞—Ä (Map/Struct)
            
            // –í–∞—Ä–∏–∞–Ω—Ç 1: (Key, Value) –∏–ª–∏ (Key,Value)
            // –†–µ–≥—É–ª—è—Ä–∫–∞: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å (, —á—Ç–æ-—Ç–æ, –∑–∞–ø—è—Ç–∞—è, —á—Ç–æ-—Ç–æ, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è )
            let structMatch = part.match(/^\(([^,]+),\s*(.+)\)$/);
            if (structMatch) {
                key = structMatch[1].trim();
                val = structMatch[2].trim();
            } 
            // –í–∞—Ä–∏–∞–Ω—Ç 2: Key=Value
            else if (part.includes('=')) {
                let eqParts = part.split('=');
                key = eqParts[0].trim();
                val = eqParts.slice(1).join('=').trim();
            }
            // –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ—Å—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ (–æ—Å—Ç–∞–≤–ª—è–µ–º Key=Value, –≥–¥–µ Value = Default)
            else {
                // –ï—Å–ª–∏ –≤—Ö–æ–¥ "A", "B", —Ç–æ key="A", val=default
                // –û—á–∏—Å—Ç–∫–∞ –∫–∞–≤—ã—á–µ–∫ –∏–∑ –∫–ª—é—á–∞ –µ—Å–ª–∏ –Ω–∞–¥–æ
                key = key.replace(/^["']|["']$/g, '');
            }

            parsedData.push({ k: key, v: val });
        });

        // 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞
        let resultItems = parsedData.map(item => {
            let str = pattern;
            // –ó–∞–º–µ–Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤
            str = str.replace(/\{k\}/g, item.k);
            str = str.replace(/\{v\}/g, item.v);
            return str;
        });

        let resultString = resultItems.join(',');
        
        if (wrapResult) {
            resultString = `(${resultString})`;
        }

        document.getElementById('outputArea').value = resultString;
    }

    function copyResult() {
        const copyText = document.getElementById("outputArea");
        copyText.select();
        document.execCommand("copy");
    }
</script>

</body>
</html>