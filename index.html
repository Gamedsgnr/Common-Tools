<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Common Tools and Libs</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ... (–°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ –∂–µ, —á—Ç–æ —è –¥–∞–≤–∞–ª —Ä–∞–Ω—å—à–µ) ... */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }
        .sidebar { width: 260px; background-color: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { padding: 20px; background-color: #2d2d2d; border-bottom: 1px solid #333; color: #4ec9b0; font-weight: bold; font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        .category-title { padding: 15px 20px 5px 20px; font-size: 0.8em; text-transform: uppercase; color: #6c6c6c; font-weight: bold; letter-spacing: 1px; }
        .nav-links { list-style: none; padding: 0; overflow-y: auto; }
        .nav-links a { display: block; padding: 12px 20px; color: #cccccc; text-decoration: none; transition: background 0.2s, color 0.2s; border-left: 3px solid transparent; font-size: 0.95em; }
        .nav-links a:hover { background-color: #2a2d2e; color: white; }
        .footer { margin-top: auto; padding: 15px; font-size: 0.8em; color: #555; text-align: center; border-top: 1px solid #333; cursor: pointer; }
        .main-content { flex-grow: 1; background-color: #1e1e1e; position: relative; }
        iframe { width: 100%; height: 100%; border: none; display: block; }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã —Å–∫—Ä—ã—Ç–∏—è */
        .admin-group { display: none; }
        
        /* –ú–æ–¥–∞–ª–∫–∞ –≤—Ö–æ–¥–∞ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal-box { background: #252526; padding: 25px; border: 1px solid #444; border-radius: 5px; width: 320px; text-align: center; }
        .modal-box input { width: 100%; padding: 10px; margin: 10px 0; background: #333; border: 1px solid #555; color: white; border-radius: 3px; }
        .modal-box button { width: 100%; padding: 10px; margin-top: 10px; background: #007acc; color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 3px; }
        .modal-box button:hover { background: #005a9e; }
        .error-msg { color: #f48771; font-size: 0.9em; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header"><span>üü¶ Common Tools</span></div>

        <div class="category-title">Visual Library</div>
        <ul class="nav-links">
            <li><a href="blueprints_view.html" target="tool-frame">üß© Blueprint Gallery</a></li>
            <li><a href="shaders_view.html" target="tool-frame">üîÆ Shader Library</a></li>
        </ul>
        <div class="category-title">Data Tools</div>
        <ul class="nav-links">
            <li><a href="UE_EnumGen.html" target="tool-frame">üíæ UE Enum Generator</a></li>
            <li><a href="UE_Converter_Pro.html" target="tool-frame">üîÑ Data Converter</a></li>
        </ul>

        <div class="category-title admin-group" style="color: #4ec9b0; border-top: 1px solid #333; padding-top: 15px;">Admin Zone</div>
        <ul class="nav-links admin-group">
            <li><a href="admin_add.html" target="tool-frame">üìù Snippet Builder</a></li>
            <li><a href="admin_bp_add.html" target="tool-frame">‚ûï BP Generator</a></li>
            <li><a href="admin_shader_add.html" target="tool-frame">üîÆ Shader Generator</a></li>
            <li><a href="#" onclick="logoutSupabase()" style="color: #f48771;">üö™ Logout</a></li>
        </ul>

        <div class="footer" onclick="openLoginModal()">
            <span id="statusIcon">üîí</span> Login via Supabase
        </div>
    </aside>

    <main class="main-content">
        <iframe src="welcome.html" name="tool-frame"></iframe>
    </main>

    <div class="modal-overlay" id="loginModal">
        <div class="modal-box">
            <h3 style="color: #4ec9b0; margin-bottom: 15px;">Supabase Auth</h3>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button onclick="loginSupabase()">SIGN IN</button>
            <button onclick="document.getElementById('loginModal').style.display='none'" style="background: transparent; color: #888;">Cancel</button>
            <div id="loginError" class="error-msg">Error message here</div>
        </div>
    </div>

    <script>
        // --- 1. –ù–ê–°–¢–†–û–ô–ö–ò SUPABASE (–í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï!) ---
    const SUPABASE_URL = 'https://vmwwvwtsznxwoswzdzui.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_hfVfEOEyUxTAl9TCGQLQdA_2qpquHGk';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- 2. –ü–†–û–í–ï–†–ö–ê –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ---
        window.onload = async function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                unlockUI(session.user);
            }
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–ª—Å—è –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ)
            supabase.auth.onAuthStateChange((event, session) => {
                if (session) unlockUI(session.user);
                else lockUI();
            });
        }

        // --- 3. –§–£–ù–ö–¶–ò–ò –í–•–û–î–ê/–í–´–•–û–î–ê ---
        function openLoginModal() {
            // –ï—Å–ª–∏ —É–∂–µ –≤–æ—à–ª–∏ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º –∏–ª–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–π—Ç–∏
            if(sessionStorage.getItem('ct_supabase_auth')) return;
            document.getElementById('loginModal').style.display = 'flex';
        }

        async function loginSupabase() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errBox = document.getElementById('loginError');

            errBox.style.display = 'none';

            const { data, error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password,
            });

            if (error) {
                errBox.innerText = error.message;
                errBox.style.display = 'block';
            } else {
                // –£—Å–ø–µ—Ö! UI –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ onAuthStateChange
                document.getElementById('loginModal').style.display = 'none';
            }
        }

        async function logoutSupabase() {
            await supabase.auth.signOut();
            lockUI();
        }

        // --- 4. –£–ü–†–ê–í–õ–ï–ù–ò–ï UI ---
        function unlockUI(user) {
            console.log("Logged in as:", user.email);
            // –°—Ç–∞–≤–∏–º —Ñ–ª–∞–≥ –≤ SessionStorage, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥—è—Ç Iframe-—ã (—Ç.–∫. one origin)
            sessionStorage.setItem('ct_supabase_auth', 'true'); 
            
            document.querySelectorAll('.admin-group').forEach(el => el.style.display = 'block');
            document.getElementById('statusIcon').innerHTML = "üü¢";
        }

        function lockUI() {
            sessionStorage.removeItem('ct_supabase_auth');
            document.querySelectorAll('.admin-group').forEach(el => el.style.display = 'none');
            document.getElementById('statusIcon').innerHTML = "üîí";
        }
    </script>
</body>
</html>