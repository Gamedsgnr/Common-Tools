<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Shader Library</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --accent-rgb: 217, 132, 96;
            --accent: #d98460;
            --accent-strong: #b36a3e;
            --accent-dark: #3a2418;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: #1a1f2b; color: #dbe7f3; padding: 20px; display: flex; height: 100vh; gap: 20px; box-sizing: border-box; margin: 0; }
        
        /* –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê */
        .list-panel { width: 320px; display: flex; flex-direction: column; gap: 12px; padding: 16px; flex-shrink: 0; background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.12), rgba(30, 41, 59, 0.45)); border: 1px solid rgba(var(--accent-rgb), 0.32); border-radius: 16px; box-shadow: 0 18px 30px -12px rgba(2, 6, 23, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.18), inset 0 -12px 22px rgba(2, 6, 23, 0.28); backdrop-filter: blur(18px) saturate(1.2); -webkit-backdrop-filter: blur(18px) saturate(1.2); }
        .search-box { background: rgba(15, 23, 42, 0.65); border: 1px solid rgba(var(--accent-rgb), 0.35); color: #e2e8f0; padding: 10px 12px; width: 100%; border-radius: 12px; box-sizing: border-box; outline: none; box-shadow: inset 0 0 12px rgba(2, 6, 23, 0.35); }
        .sh-list { overflow-y: auto; flex: 1; }
        
        .loading-text { text-align: center; color: #94a3b8; margin-top: 20px; font-style: italic; }

        .sh-item { padding: 12px; margin-bottom: 8px; cursor: pointer; border-radius: 12px; transition: 0.2s; border: 1px solid rgba(var(--accent-rgb), 0.22); background: rgba(15, 23, 42, 0.55); position: relative; overflow: hidden; }
        .sh-item:hover { background-color: rgba(30, 41, 59, 0.65); border-color: rgba(var(--accent-rgb), 0.45); box-shadow: 0 12px 18px -12px rgba(2, 6, 23, 0.7); }
        .sh-item.active {
            background: rgba(30, 41, 59, 0.45);
            border-color: rgba(var(--accent-rgb), 0.42);
            color: #eaf3ff;
            box-shadow:
                0 14px 20px -12px rgba(2, 6, 23, 0.7),
                inset 0 1px 0 rgba(255, 255, 255, 0.22),
                inset 0 -10px 22px rgba(2, 6, 23, 0.32);
        }
        .sh-item.active::before {
            content: '';
            position: absolute;
            inset: 4px;
            border-radius: 10px;
            background:
                linear-gradient(160deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.02) 55%),
                linear-gradient(340deg, rgba(var(--accent-rgb), 0.14), rgba(var(--accent-rgb), 0) 60%);
            box-shadow:
                inset 0 0 10px rgba(255, 255, 255, 0.08),
                inset 0 0 18px rgba(var(--accent-rgb), 0.08);
            opacity: 0.9;
            pointer-events: none;
        }
        .sh-item.active::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            background:
                linear-gradient(135deg, rgba(2, 6, 23, 0.18), rgba(2, 6, 23, 0) 55%),
                linear-gradient(315deg, rgba(2, 6, 23, 0.26), rgba(2, 6, 23, 0) 60%);
            opacity: 0.8;
            pointer-events: none;
        }
        .sh-item.active .s-title { color: var(--accent); }
        .sh-item > span { position: relative; z-index: 1; }
        
        .s-title { font-weight: bold; display: block; color: var(--accent); }
        .s-desc { font-size: 0.8em; color: #94a3b8; margin-top: 4px; display: block; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }

        /* –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê */
        .detail-panel { flex: 1; display: flex; flex-direction: column; background: linear-gradient(145deg, rgba(var(--accent-rgb), 0.08), rgba(15, 23, 42, 0.58)); border-radius: 18px; border: 1px solid rgba(var(--accent-rgb), 0.3); overflow: hidden; position: relative; box-shadow: 0 20px 30px -12px rgba(2, 6, 23, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.12), inset 0 -14px 24px rgba(2, 6, 23, 0.28); backdrop-filter: blur(18px) saturate(1.2); -webkit-backdrop-filter: blur(18px) saturate(1.2); }
        
        /* –¢–£–õ–ë–ê–† */
        .toolbar {
            min-height: 60px;
            background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.12), rgba(30, 41, 59, 0.55)); border-bottom: 1px solid rgba(var(--accent-rgb), 0.28);
            display: flex; align-items: center; justify-content: space-between; 
            padding: 10px 20px;
            box-sizing: border-box;
        }
        
        .header-info { display: flex; flex-direction: column; justify-content: center; gap: 4px; }
        .main-title { font-weight: bold; color: #e2e8f0; font-size: 1.1em; }
        .sub-desc { font-size: 0.9em; color: #94a3b8; max-width: 600px; }

        .btn-copy {
            background-color: var(--accent-strong); color: white; border: 1px solid rgba(var(--accent-rgb), 0.48); padding: 8px 16px; 
            border-radius: 10px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; flex-shrink: 0;
            display: none;
            box-shadow: 0 10px 18px -12px rgba(2, 6, 23, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        .btn-copy:hover { filter: brightness(1.1); }
        .btn-copy:active { transform: translateY(1px); }

        .frame-container { flex: 1; position: relative; background: #1a1f2b; }
        
        iframe { width: 100%; height: 100%; border: none; display: none; }
        .placeholder { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #64748b; font-size: 1.2em; }
    </style>
</head>
<body>

    <div class="list-panel">
        <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ —à–µ–π–¥–µ—Ä–∞..." onkeyup="renderList(this.value)">
        <div class="sh-list" id="listContainer">
            <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã...</div>
        </div>
    </div>

    <div class="detail-panel">
        <div class="toolbar">
            <div class="header-info">
                <span id="headerTitle" class="main-title">–í—ã–±–µ—Ä–∏—Ç–µ —à–µ–π–¥–µ—Ä</span>
                <span id="headerDesc" class="sub-desc"></span>
            </div>

            <button class="btn-copy" onclick="copyRawCode()" id="copyBtn">
                üìÑ COPY NODES
            </button>
        </div>
        <div class="frame-container">
            <div class="placeholder" id="placeholder">Select a Shader</div>
            <iframe id="shFrame" scrolling="no" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        // --- 1. –ù–ê–°–¢–†–û–ô–ö–ò SUPABASE ---
    const SUPABASE_URL = 'https://vmwwvwtsznxwoswzdzui.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_hfVfEOEyUxTAl9TCGQLQdA_2qpquHGk';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let shadersData = [];

        const listContainer = document.getElementById('listContainer');
        const shFrame = document.getElementById('shFrame');
        const placeholder = document.getElementById('placeholder');
        
        const headerTitle = document.getElementById('headerTitle');
        const headerDesc = document.getElementById('headerDesc');
        const copyBtn = document.getElementById('copyBtn');
        
        let currentRawCode = "";

        // --- 2. –ó–ê–ì–†–£–ó–ö–ê ---
        async function fetchShaders() {
            const { data, error } = await _supabase
                .from('shaders')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                listContainer.innerHTML = `<div class="loading-text" style="color:#b98989">–û—à–∏–±–∫–∞: ${error.message}</div>`;
                return;
            }

            shadersData = data;
            renderList();
        }

        // --- 3. –û–¢–†–ò–°–û–í–ö–ê ---
        function renderList(filter = "") {
            listContainer.innerHTML = "";
            
            if (shadersData.length === 0) {
                listContainer.innerHTML = `<div class="loading-text">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>`;
                return;
            }

            const searchParts = filter.toLowerCase().split(' ').filter(p => p.trim() !== "");

            shadersData.forEach((item, index) => {
                const descText = item.description || item.desc || "";

                if (searchParts.length > 0) {
                    const searchTarget = (item.title + " " + descText).toLowerCase();
                    const isMatch = searchParts.every(part => searchTarget.includes(part));
                    if (!isMatch) return;
                }

                const div = document.createElement('div');
                div.className = 'sh-item';
                div.innerHTML = `<span class="s-title">üîÆ ${item.title}</span><span class="s-desc">${descText}</span>`;
                div.onclick = () => loadShader(index, div);
                listContainer.appendChild(div);
            });
        }

        function loadShader(index, element) {
            const item = shadersData[index];
            document.querySelectorAll('.sh-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');

            const descText = item.description || item.desc || "";

            placeholder.style.display = 'none';
            shFrame.style.display = 'block';
            
            // –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            if (item.code) {
                copyBtn.style.display = 'flex';
                currentRawCode = item.code;
            } else {
                copyBtn.style.display = 'none';
            }
            
            headerTitle.innerText = item.title;
            headerDesc.innerText = descText;

            // –ó–∞–≥—Ä—É–∑–∫–∞ iframe
            if (item.embed_id) {
                shFrame.src = `https://blueprintue.com/render/${item.embed_id}/`;
            } else if (item.embedId) { 
                shFrame.src = `https://blueprintue.com/render/${item.embedId}/`;
            } else {
                shFrame.style.display = 'none';
                placeholder.style.display = 'block';
                placeholder.innerText = "No Embed ID found";
            }
        }

        function copyRawCode() {
            if (!currentRawCode) { alert("–ù–µ—Ç –∫–æ–¥–∞"); return; }
            navigator.clipboard.writeText(currentRawCode).then(() => {
                const originalText = copyBtn.innerText;
                copyBtn.innerText = "‚úÖ COPIED!";
                setTimeout(() => copyBtn.innerText = originalText, 1500);
            });
        }

        document.addEventListener('DOMContentLoaded', fetchShaders);
    </script>
</body>
</html>

